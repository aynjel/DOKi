image: node:10.8.0
options:
    max-time: 15
    docker: true
    size: 2x

pipelines:
    # default:
    #     - step:
    #         name: Pipeline Cypress E2E
    #         caches:
    #             - npm
    #             - cypress
    #         image: cypress/base:10
    #         script:
    #             - npm ci
    #             - npx cypress run
    #         artifacts:
    #             - cypress/screenshots/**
    #             - cypress/reports/**
    #             - cypress/videos/**
    branches:
        '{master,dev_branch}':
            - step:
                name: Doctors' Portal PWA E2E Tests
                caches:
                    - docker
                #    - npm
                #    - cypress
                #image: cypress/base:10
                image: docker/compose:latest
                services:
                    - docker
                size: 2x
                script:
                    - echo "Building and then Test the app..."
                    #- docker-compose -f docker-compose-cypress.yml build 
                    - docker-compose -f docker-compose-cypress.yml up --exit-code-from cypress
                    #- npm ci
                    #- npx cypress run
                #artifacts:
                    #- cypress/screenshots/**
                    #- cypress/reports/**
                    #- cypress/videos/**

definitions:
    caches:
        npm: $HOME/.npm
        cypress: $HOME/.cache/Cypress
    services:
        docker:
            memory: 4096